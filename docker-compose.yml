services:
  neogpt:
    build: .
    image: ${NEOGPT_IMAGE:-neogpt}
    container_name: neogpt
    restart: unless-stopped
    ports:
      - "${PORT:-3000}:3000"
    environment:
      NODE_ENV: development
      PORT: 3000
      SESSION_SECRET: ${SESSION_SECRET:?SESSION_SECRET must be set in .env}
      OPENAI_API_KEY: ${OPENAI_API_KEY:-}
      TAVILY_API_KEY: ${TAVILY_API_KEY:-}
      TRUST_PROXY: ${TRUST_PROXY:-0}
    volumes:
      # Persists SQLite databases and session store across container restarts
      - neogpt__db_data:/app/data
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:3000/"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 15s
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  neogpt_data:
    driver: local
